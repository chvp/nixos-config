From 49c4f0707bea5d75888b35ad6ef1e921875f8ff9 Mon Sep 17 00:00:00 2001
From: Charlotte Van Petegem <charlotte.vanpetegem@ugent.be>
Date: Tue, 21 Mar 2023 16:06:00 +0100
Subject: [PATCH] matrix-hookshot: 3.0.0 -> 3.0.1

https://github.com/matrix-org/matrix-hookshot/releases/tag/3.0.1
---
 pkgs/servers/matrix-synapse/matrix-hookshot/default.nix  | 2 +-
 pkgs/servers/matrix-synapse/matrix-hookshot/package.json | 2 +-
 pkgs/servers/matrix-synapse/matrix-hookshot/pin.json     | 7 ++++---
 pkgs/servers/matrix-synapse/matrix-hookshot/update.sh    | 4 +++-
 4 files changed, 9 insertions(+), 6 deletions(-)

diff --git a/pkgs/servers/matrix-synapse/matrix-hookshot/default.nix b/pkgs/servers/matrix-synapse/matrix-hookshot/default.nix
index ae5ac99b6645c..840860f90d914 100644
--- a/pkgs/servers/matrix-synapse/matrix-hookshot/default.nix
+++ b/pkgs/servers/matrix-synapse/matrix-hookshot/default.nix
@@ -35,7 +35,7 @@ mkYarnPackage rec {
   cargoDeps = rustPlatform.fetchCargoTarball {
     inherit src;
     name = "${pname}-${version}";
-    hash = "sha256-bxDqv7KofinDuYDB1F0ZKWUQnz+ErU+OZc6i77nzM9Q=";
+    sha256 = data.cargoHash;
   };
 
   packageResolutions = {
diff --git a/pkgs/servers/matrix-synapse/matrix-hookshot/package.json b/pkgs/servers/matrix-synapse/matrix-hookshot/package.json
index 8b9701d09d765..23aa4ad34d250 100644
--- a/pkgs/servers/matrix-synapse/matrix-hookshot/package.json
+++ b/pkgs/servers/matrix-synapse/matrix-hookshot/package.json
@@ -1,6 +1,6 @@
 {
   "name": "matrix-hookshot",
-  "version": "3.0.0",
+  "version": "3.0.1",
   "description": "A bridge between Matrix and multiple project management services, such as GitHub, GitLab and JIRA.",
   "main": "lib/app.js",
   "repository": "https://github.com/matrix-org/matrix-hookshot",
diff --git a/pkgs/servers/matrix-synapse/matrix-hookshot/pin.json b/pkgs/servers/matrix-synapse/matrix-hookshot/pin.json
index b4c0f27ecfa02..bd8bc6de75121 100644
--- a/pkgs/servers/matrix-synapse/matrix-hookshot/pin.json
+++ b/pkgs/servers/matrix-synapse/matrix-hookshot/pin.json
@@ -1,5 +1,6 @@
 {
-  "version": "3.0.0",
-  "srcHash": "2fuDV2h97VdBADygMeyk2B5etFKkQdNZeOWlhMD4hJk=",
-  "yarnHash": "0ivizv90wrbz583xjvbakv6vg782h7pjm5zbm8wb9qkpnj735avz"
+  "version": "3.0.1",
+  "srcHash": "GQfQWOyiI/rxRsj9GYoc2wPaG8phl+2d9Hulxrar5Jc=",
+  "yarnHash": "0ivizv90wrbz583xjvbakv6vg782h7pjm5zbm8wb9qkpnj735avz",
+  "cargoHash": "/yEupeMwzTh/Ujbh2mPXXQbUCajFK/yl1QM3XmFS/Cc="
 }
diff --git a/pkgs/servers/matrix-synapse/matrix-hookshot/update.sh b/pkgs/servers/matrix-synapse/matrix-hookshot/update.sh
index 4d91ec7533297..1ffde25917d20 100755
--- a/pkgs/servers/matrix-synapse/matrix-hookshot/update.sh
+++ b/pkgs/servers/matrix-synapse/matrix-hookshot/update.sh
@@ -26,10 +26,12 @@ yarn_hash=$(prefetch-yarn-deps yarn.lock)
 popd
 
 curl -O "$src/package.json"
+# There is no prefetcher for the cargo hash, but care should still be taken to update it
 cat > pin.json << EOF
 {
   "version": "$version",
   "srcHash": "$src_hash",
-  "yarnHash": "$yarn_hash"
+  "yarnHash": "$yarn_hash",
+  "cargoHash": "0000000000000000000000000000000000000000000000000000"
 }
 EOF
