From 80bd40cd9d3ba4472d3f0efc48f3770390db0242 Mon Sep 17 00:00:00 2001
From: Daniel Thwaites <danthwaites30@btinternet.com>
Date: Sat, 24 Sep 2022 20:25:42 +0100
Subject: [PATCH] zeroad: 0.0.25b -> 0.0.26

---
 pkgs/games/0ad/data.nix |  2 +-
 pkgs/games/0ad/game.nix | 17 +++++------------
 2 files changed, 6 insertions(+), 13 deletions(-)

diff --git a/pkgs/games/0ad/data.nix b/pkgs/games/0ad/data.nix
index 57018e04904c6..4437a5d26995b 100644
--- a/pkgs/games/0ad/data.nix
+++ b/pkgs/games/0ad/data.nix
@@ -6,7 +6,7 @@ stdenv.mkDerivation rec {
 
   src = fetchurl {
     url = "http://releases.wildfiregames.com/0ad-${version}-alpha-unix-data.tar.xz";
-    sha256 = "1c9zrddmjxvvacismld6fbwbw9vrdbq6g6d3424p8w5p6xg5wlwy";
+    sha256 = "sgDkhVj4goB5EOPGhlZ7ajliSNnUGAROz94JCwV3LX0=";
   };
 
   installPhase = ''
diff --git a/pkgs/games/0ad/game.nix b/pkgs/games/0ad/game.nix
index e51aab519a490..23e906703f433 100644
--- a/pkgs/games/0ad/game.nix
+++ b/pkgs/games/0ad/game.nix
@@ -2,7 +2,7 @@
 , pkg-config, spidermonkey_78, boost, icu, libxml2, libpng, libsodium
 , libjpeg, zlib, curl, libogg, libvorbis, enet, miniupnpc
 , openal, libGLU, libGL, xorgproto, libX11, libXcursor, nspr, SDL2
-, gloox, nvidia-texture-tools
+, gloox, nvidia-texture-tools, freetype
 , withEditor ? true, wxGTK
 }:
 
@@ -26,11 +26,11 @@ let
 in
 stdenv.mkDerivation rec {
   pname = "0ad";
-  version = "0.0.25b";
+  version = "0.0.26";
 
   src = fetchurl {
     url = "http://releases.wildfiregames.com/0ad-${version}-alpha-unix-build.tar.xz";
-    sha256 = "1p9fa8f7sjb9c5wl3mawzyfqvgr614kdkhrj2k4db9vkyisws3fp";
+    sha256 = "Lhxt9+MxLnfF+CeIZkz/w6eNO/YGBsAAOSdeHRPA7ks=";
   };
 
   nativeBuildInputs = [ python3 perl pkg-config ];
@@ -39,7 +39,7 @@ stdenv.mkDerivation rec {
     spidermonkey_78_6 boost icu libxml2 libpng libjpeg
     zlib curl libogg libvorbis enet miniupnpc openal libidn
     libGLU libGL xorgproto libX11 libXcursor nspr SDL2 gloox
-    nvidia-texture-tools libsodium fmt
+    nvidia-texture-tools libsodium fmt freetype
   ] ++ lib.optional withEditor wxGTK;
 
   NIX_CFLAGS_COMPILE = toString [
@@ -50,14 +50,7 @@ stdenv.mkDerivation rec {
     "-I${fmt.dev}/include"
   ];
 
-  patches = [
-    ./rootdir_env.patch
-    (fetchpatch {
-      # fix build with gcc11 and glibc 2.35
-      url = "https://github.com/0ad/0ad/commit/7df614338cbd41f5e254ce75f649490b2637e1d0.patch";
-      hash = "sha256-QZvcNm8Zni3aJnMPueft0OITf8zeMDXWBjOLYoirJs0=";
-    })
-  ];
+  patches = [ ./rootdir_env.patch ];
 
   configurePhase = ''
     # Delete shipped libraries which we don't need.
