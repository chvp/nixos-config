From 2852d296f1fa43ca89d2c8aa342e3b5d2deb3a42 Mon Sep 17 00:00:00 2001
From: Izorkin <izorkin@elven.pw>
Date: Tue, 28 Mar 2023 13:19:25 +0300
Subject: [PATCH] mastodon: update ruby package

---
 pkgs/servers/mastodon/gemset.nix | 5 ++---
 pkgs/servers/mastodon/source.nix | 9 +++++++--
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/pkgs/servers/mastodon/gemset.nix b/pkgs/servers/mastodon/gemset.nix
index 5c1a1e3d985ee..3e1632860b56e 100644
--- a/pkgs/servers/mastodon/gemset.nix
+++ b/pkgs/servers/mastodon/gemset.nix
@@ -353,15 +353,14 @@
     version = "1.0.0";
   };
   blurhash = {
-    dependencies = ["ffi"];
     groups = ["default"];
     platforms = [];
     source = {
       remotes = ["https://rubygems.org"];
-      sha256 = "1rs61mwdiyriq8mb8na2sfrqzz8igls04md63ajyhk4yj8d2j0sz";
+      sha256 = "057afgqy73n8vm7k3cr4pbwm1hhqnm58lp4x7bgm5wzbs39m7xf8";
       type = "gem";
     };
-    version = "0.1.6";
+    version = "0.1.7";
   };
   bootsnap = {
     dependencies = ["msgpack"];
diff --git a/pkgs/servers/mastodon/source.nix b/pkgs/servers/mastodon/source.nix
index b51afb602c2bf..19ee9982aaf73 100644
--- a/pkgs/servers/mastodon/source.nix
+++ b/pkgs/servers/mastodon/source.nix
@@ -1,5 +1,5 @@
 # This file was generated by pkgs.mastodon.updateScript.
-{ fetchgit, applyPatches }: let
+{ fetchgit, applyPatches, fetchpatch }: let
   src = fetchgit {
     url = "https://github.com/mastodon/mastodon.git";
     rev = "v4.1.1";
@@ -7,5 +7,10 @@
   };
 in applyPatches {
   inherit src;
-  patches = [];
+  patches = [
+    (fetchpatch {
+      url = "https://github.com/mastodon/mastodon/commit/61b069b20ef6977703721ae44ae8a68be6bb0992.patch";
+      hash = "sha256-cF0wtbjTNbsyqHb3uy5zYFaACIcziJ2ulJpOT5VoDO0=";
+    })
+  ];
 }
