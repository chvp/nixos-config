From 6e060c01b8a5e85ccfc5dadaef9ffe5a1332f1ab Mon Sep 17 00:00:00 2001
From: Charlotte Van Petegem <charlotte@vanpetegem.me>
Date: Mon, 6 Mar 2023 21:30:06 +0100
Subject: [PATCH] matrix-appservice-slack: 2.0.2 -> 2.1.0

https://github.com/matrix-org/matrix-appservice-slack/releases/tag/2.1.0
---
 .../matrix-appservice-slack/package.json      | 32 +++++++++++++++----
 .../matrix-appservice-slack/pin.json          |  6 ++--
 .../matrix-appservice-slack/update.sh         |  2 +-
 3 files changed, 29 insertions(+), 11 deletions(-)

diff --git a/pkgs/servers/matrix-synapse/matrix-appservice-slack/package.json b/pkgs/servers/matrix-synapse/matrix-appservice-slack/package.json
index e52f1221327c5..dd5c93989c8dd 100644
--- a/pkgs/servers/matrix-synapse/matrix-appservice-slack/package.json
+++ b/pkgs/servers/matrix-synapse/matrix-appservice-slack/package.json
@@ -1,6 +1,6 @@
 {
   "name": "matrix-appservice-slack",
-  "version": "2.0.2",
+  "version": "2.1.0",
   "description": "A Matrix <--> Slack bridge",
   "engines": {
     "node": ">=16 <=18"
@@ -9,12 +9,14 @@
   "scripts": {
     "prepare": "yarn build",
     "start": "node ./lib/app.js",
-    "build": "tsc --build",
+    "build": "yarn build:app && yarn build:widget",
+    "build:app": "tsc --build",
+    "build:widget": "vite build --config widget/vite.config.ts",
     "test": "yarn test:unit && yarn test:integration",
     "test:unit": "mocha --require ts-node/register --recursive tests/unit/*.ts",
     "test:integration": "mocha --exit --reporter list --ui bdd --require ts-node/register --recursive tests/integration/*.ts",
     "test:postgres": "SLACKBRIDGE_TEST_ENABLEPG=yes mocha --reporter list --ui bdd --require ts-node/register --recursive tests/integration/PgDatastoreTest.ts",
-    "lint": "eslint -c .eslintrc.js ./src"
+    "lint": "eslint -c .eslintrc.js ./src && eslint -c ./widget/.eslintrc.js 'widget/src/**/*.{ts,tsx}'"
   },
   "repository": {
     "type": "git",
@@ -36,9 +38,12 @@
     "@slack/rtm-api": "^6.0.0",
     "@slack/web-api": "^6.7.2",
     "Slackdown": "git+https://Half-Shot@github.com/half-shot/slackdown.git",
+    "ajv": "^8.12.0",
     "axios": "^0.27.2",
+    "classnames": "^2.3.2",
     "escape-string-regexp": "^4.0.0",
-    "matrix-appservice-bridge": "^6.0.0",
+    "matrix-appservice-bridge": "^8.1.0",
+    "matrix-widget-api": "^1.1.1",
     "minimist": "^1.2.6",
     "nedb": "^1.8.0",
     "node-emoji": "^1.10.0",
@@ -46,10 +51,14 @@
     "p-queue": "^6.0.0",
     "pg-promise": "^10.11.1",
     "randomstring": "^1.2.1",
+    "react": "^18.2.0",
+    "react-dom": "^18.2.0",
+    "url-join": "^5.0.0",
     "uuid": "^8.3.2",
     "yargs": "17.5.1"
   },
   "devDependencies": {
+    "@tailwindcss/forms": "^0.5.3",
     "@tsconfig/node16": "^1.0.3",
     "@types/chai": "^4.2.21",
     "@types/js-yaml": "^4.0.2",
@@ -59,19 +68,28 @@
     "@types/node-emoji": "^1.8.1",
     "@types/nunjucks": "^3.1.5",
     "@types/randomstring": "^1.1.7",
+    "@types/react": "^18.0.27",
+    "@types/react-dom": "^18.0.10",
     "@types/uuid": "^8.3.1",
     "@types/yargs": "17.0.10",
-    "@typescript-eslint/eslint-plugin": "^5.31.0",
-    "@typescript-eslint/parser": "^5.31.0",
+    "@typescript-eslint/eslint-plugin": "^5.0.0",
+    "@typescript-eslint/parser": "^5.50.0",
+    "@vitejs/plugin-react": "^3.1.0",
+    "autoprefixer": "^10.4.13",
     "chai": "^4.3.4",
     "eslint": "^8.20.0",
     "eslint-plugin-jsdoc": "^39.3.3",
     "eslint-plugin-prefer-arrow": "^1.2.3",
+    "eslint-plugin-react": "^7.32.2",
+    "eslint-plugin-react-hooks": "^4.6.0",
     "js-yaml": "^4.1.0",
     "mocha": "^10.0.0",
+    "postcss": "^8.4.21",
     "prom-client": "^14.0.1",
     "source-map-support": "^0.5.19",
+    "tailwindcss": "^3.2.4",
     "ts-node": "^10.1.0",
-    "typescript": "^4.4.3"
+    "typescript": "^4.4.3",
+    "vite": "^4.1.1"
   }
 }
diff --git a/pkgs/servers/matrix-synapse/matrix-appservice-slack/pin.json b/pkgs/servers/matrix-synapse/matrix-appservice-slack/pin.json
index f842fda7ba5f4..06d4e4b142665 100644
--- a/pkgs/servers/matrix-synapse/matrix-appservice-slack/pin.json
+++ b/pkgs/servers/matrix-synapse/matrix-appservice-slack/pin.json
@@ -1,5 +1,5 @@
 {
-  "version": "2.0.2",
-  "srcHash": "Z8PQuAOQbQMxmso/KV9n8fu2FqzqLsADqLczmm584QQ=",
-  "yarnHash": "1ngmgr9li7jagvzfl0jq4bxqw0q1sdqh8k9wlar6q292263g287z"
+  "version": "2.1.0",
+  "srcHash": "qAmbW/aDeBWTi1czQtrsb6d5TEYw9gYJ4lpJbaX9nb0=",
+  "yarnHash": "1r5fqw7y8fzgjnl5xlr8djfmmkm8kqw5p3w12ffll6irwz90wajx"
 }
diff --git a/pkgs/servers/matrix-synapse/matrix-appservice-slack/update.sh b/pkgs/servers/matrix-synapse/matrix-appservice-slack/update.sh
index 647daae22144d..92494a3c8bebf 100755
--- a/pkgs/servers/matrix-synapse/matrix-appservice-slack/update.sh
+++ b/pkgs/servers/matrix-synapse/matrix-appservice-slack/update.sh
@@ -1,5 +1,5 @@
 #!/usr/bin/env nix-shell
-#!nix-shell -I nixpkgs=../../../../ -i bash -p nix curl jq prefetch-yarn-deps nix-prefetch-github
+#!nix-shell -I nixpkgs=../../../../ -i bash -p nix curl jq prefetch-yarn-deps nix-prefetch-github nix-prefetch-git
 
 if [ "$#" -gt 1 ] || [[ "$1" == -* ]]; then
   echo "Regenerates packaging data for matrix-appservice-slack."
